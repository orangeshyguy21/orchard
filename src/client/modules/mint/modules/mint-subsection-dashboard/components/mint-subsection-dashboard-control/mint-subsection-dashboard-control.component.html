<div class="mint-analytic-control-panel-container">
	<form [formGroup]="panel" class="panel-form orc-animation-form-reaction" [class.animation-invalid]="height_state === 'invalid'">
		<div class="flex flex-col flex-gap-1">
			<div formGroupName="daterange">
				<mat-form-field hideRequiredMarker="true" subscriptSizing="dynamic" class="mint-analytic-daterange">
					<mat-label>Date range</mat-label>
					<mat-date-range-input [rangePicker]="picker">
						<input
							matStartDate
							formControlName="date_start"
							placeholder="Start date"
							(blur)="onDateChange()"
							(keyup.enter)="onDateChange()"
						/>
						<input
							matEndDate
							formControlName="date_end"
							placeholder="End date"
							(blur)="onDateChange()"
							(keyup.enter)="onDateChange()"
						/>
					</mat-date-range-input>
					<mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
					<mat-date-range-picker #picker [dateClass]="genesis_class" (closed)="onDateChange()"></mat-date-range-picker>
					@if (panel.get('daterange')?.invalid) {
						<mat-error class="font-size-xs">Invalid date range</mat-error>
					}
				</mat-form-field>
			</div>

			<div>
				<mat-form-field hideRequiredMarker="true" subscriptSizing="dynamic">
					<mat-label>Interval</mat-label>
					<mat-select formControlName="interval" (selectionChange)="onIntervalChange($event)">
						@for (interval of interval_options; track interval.value) {
							<mat-option [value]="interval.value">{{ interval.label }}</mat-option>
						}
					</mat-select>
				</mat-form-field>
			</div>

			<div class="p-t-0-5">
				<button matButton type="button" [matMenuTriggerFor]="filter_menu">
					<mat-icon>tune</mat-icon>
					<span class="text-nowrap font-size-s">Filters {{ filter_count() > 0 ? `(${filter_count()})` : '' }}</span>
				</button>
			</div>
		</div>
	</form>
</div>

<mat-menu #filter_menu="matMenu" yPosition="below" class="orc-sticky-menu orc-filter-menu">
	<orc-form-filter-menu (click)="$event.stopPropagation()" (clear)="onClearFilter()" (close)="onCloseFilter()">
		<div class="orc-filter-menu-section">
			<div>Units</div>
			<div class="filter-options">
				@for (unit of unit_options; track unit.value; let i = $index) {
					<mat-checkbox [formControl]="panel.controls.units.at(i)" (change)="onUnitsChange()">
						{{ unit.label }}
					</mat-checkbox>
				}
			</div>
		</div>
	</orc-form-filter-menu>
</mat-menu>
