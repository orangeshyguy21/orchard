<div class="mint-keyset-table-container" [class.mobile-keyset-table]="mobile_view()">
	<mat-card appearance="outlined">
		@if (!loading() && data_source()) {
			<div class="p-h-1" animate.enter="orc-animation-fadein">
				<table mat-table [multiTemplateDataRows]="mobile_view()" [dataSource]="data_source()" matSort class="orc-feature-table">
					<ng-container matColumnDef="keyset">
						<th mat-header-cell *matHeaderCellDef class="keyset-table-sticky-header">Keyset</th>
						<td mat-cell *matCellDef="let keyset">
							<div class="flex flex-items-center flex-gap-1 p-v-1">
								<orc-graphic-asset [unit]="keyset.unit" [height]="'1.5rem'"> </orc-graphic-asset>
								<div class="w-min-12">
									<orc-mint-general-keyset
										[active]="keyset.active"
										[index]="keyset.derivation_path_index"
										[input_fee_ppk]="keyset.input_fee_ppk"
									>
									</orc-mint-general-keyset>
								</div>
								@if (!mobile_view()) {
									<span class="text-sm orc-outline-variant-color"> {{ keyset.id }} </span>
								}
							</div>
						</td>
					</ng-container>

					<ng-container matColumnDef="input_fee_ppk">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="keyset-table-sticky-header text-nowrap">Fee rate</th>
						<td mat-cell *matCellDef="let keyset">
							@if (keyset.input_fee_ppk > 0) {
								<div class="text-nowrap">{{ keyset.input_fee_ppk }} ppk</div>
							} @else {
								<div class="text-nowrap orc-outline-color">No fee</div>
							}
						</td>
					</ng-container>

					<ng-container matColumnDef="valid_from">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="keyset-table-sticky-header">Created</th>
						<td mat-cell *matCellDef="let keyset">
							<span class="text-nowrap">{{ keyset.valid_from | localTime: 'date-only' }}</span>
						</td>
					</ng-container>

					<ng-container matColumnDef="balance">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="keyset-table-sticky-header">Balance</th>
						<td mat-cell *matCellDef="let keyset">
							<span
								class="font-size-m w-min-10 text-nowrap"
								[innerHTML]="keyset.balance | localAmount: keyset.unit : 'mint'"
							></span>
						</td>
					</ng-container>

					<ng-container matColumnDef="fees">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="keyset-table-sticky-header text-nowrap">
							Fee revenue
						</th>
						<td mat-cell *matCellDef="let keyset">
							<span
								class="font-size-m w-min-10 text-nowrap"
								[innerHTML]="keyset.fees_paid | localAmount: keyset.unit : 'mint'"
							></span>
						</td>
					</ng-container>

					<ng-container matColumnDef="proofs">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="keyset-table-sticky-header">Proofs</th>
						<td mat-cell *matCellDef="let keyset">
							<span class="font-size-m w-min-10">{{ keyset.proof_count | number: '1.0-0' }}</span>
						</td>
					</ng-container>

					<ng-container matColumnDef="actions">
						<th mat-header-cell *matHeaderCellDef class="data-table-sticky-header">Actions</th>
						<td mat-cell *matCellDef="let keyset">
							<div class="flex flex-items-center">
								@if (keyset.active) {
									<button
										mat-icon-button
										class="orc-icon-button"
										matTooltip="Rotate Keyset"
										matTooltipPosition="left"
										(click)="$event.stopPropagation(); $event.preventDefault(); rotateKeyset.emit(keyset.unit)"
									>
										<mat-icon>switch_access_shortcut_add</mat-icon>
									</button>
								}
							</div>
						</td>
					</ng-container>

					<ng-container matColumnDef="more_detail">
						<td mat-cell *matCellDef="let keyset" [attr.colspan]="displayed_columns().length">
							<div class="more-entity-wrapper" [class.more-entity-wrapper-expanded]="more_entity()?.id === keyset.id">
								<div class="more-entity-content flex-gap-1 flex-column">
									<div class="flex-grow flex flex-items-center flex-justify-center">
										<div class="flex flex-items-center flex-gap-1 p-v-1">
											<orc-graphic-asset [unit]="keyset.unit" [height]="'1.5rem'"> </orc-graphic-asset>
											<div class="w-min-12">
												<orc-mint-general-keyset
													[active]="keyset.active"
													[index]="keyset.derivation_path_index"
													[input_fee_ppk]="keyset.input_fee_ppk"
												>
												</orc-mint-general-keyset>
											</div>
											<span class="text-sm orc-outline-variant-color"> {{ keyset.id }} </span>
										</div>
									</div>
									<div class="p-b-1 flex flex-gap-1 flex-row flex-wrap">
										<div class="flex-1 flex flex-column flex-gap-1">
											<div class="flex flex-gap-1">
												<div class="w-8 orc-outline-color font-weight-extra-light">Fee rate:</div>
												@if (keyset.input_fee_ppk > 0) {
													<div class="text-nowrap">{{ keyset.input_fee_ppk }} ppk</div>
												} @else {
													<div class="text-nowrap orc-outline-color">No fee</div>
												}
											</div>
											<div class="flex flex-gap-1">
												<div class="w-8 orc-outline-color font-weight-extra-light">Created:</div>
												<div class="text-nowrap">
													{{ keyset.valid_from | localTime: 'date-only' }}
												</div>
											</div>
										</div>
										<div class="flex-1 flex flex-column flex-gap-1">
											<div class="flex flex-gap-1">
												<div class="w-8 orc-outline-color font-weight-extra-light">Balance:</div>
												<span
													class="font-size-m w-min-10 text-nowrap"
													[innerHTML]="keyset.balance | localAmount: keyset.unit : 'mint'"
												></span>
											</div>
											<div class="flex flex-gap-1">
												<div class="w-8 orc-outline-color font-weight-extra-light text-nowrap">Fee Revenue:</div>
												<div
													class="font-size-m w-min-10 text-nowrap"
													[innerHTML]="keyset.fees_paid | localAmount: keyset.unit : 'mint'"
												></div>
											</div>
											<div class="flex flex-gap-1">
												<div class="w-8 orc-outline-color font-weight-extra-light">Proofs:</div>
												<div class="font-size-m w-min-10">{{ keyset.proof_count | number: '1.0-0' }}</div>
											</div>
											@if (keyset.active) {
												<div class="flex flex-gap-1">
													<div class="flex flex-items-center">
														<div class="w-8 orc-outline-color font-weight-extra-light">Actions:</div>
														<button mat-stroked-button color="primary" (click)="rotateKeyset.emit(keyset.unit)">
															<mat-icon class="mat-symbol-outline">switch_access_shortcut_add</mat-icon>
															Rotate keyset
														</button>
													</div>
												</div>
											}
										</div>
									</div>
								</div>
							</div>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="displayed_columns(); sticky: true"></tr>
					<tr
						mat-row
						*matRowDef="let row; columns: displayed_columns()"
						class="entity-row"
						[class.expanded]="more_entity() === row"
						(click)="toggleMore(row)"
					></tr>
					@if (mobile_view()) {
						<tr mat-row *matRowDef="let row; columns: ['more_detail']" class="more-entity-row"></tr>
					}
				</table>
			</div>
		} @else {
			<div class="flex flex-items-center flex-justify-center h-min-18">
				<mat-icon class="icon-lg mat-symbol-outline orc-outline-variant-color">table</mat-icon>
			</div>
		}
	</mat-card>
</div>
